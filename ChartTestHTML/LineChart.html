<!DOCTYPE html>
<html>
<header>
    <meta charset="utf-8">
    <title>Fertsman.com LineChart</title>

    <!-- Chart js bundle min -->
    <script src="https://www.chartjs.org/dist/2.9.4/Chart.min.js"></script>

    <!-- Jquery EXCLUDE FROM SITE WIDE -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Open Sans Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

    <!-- Fertsman.com CSS Stylesheet -->
    <link rel="stylesheet" href="../Fertsman.css">

    <!-- Fertsman.com Chart Script -->
    <script src="../SheetsAPIKey.js"></script>
    <script src="../FertsmanCharts.js"></script>
    <script src="../LineChart.js"></script>

</header>

<body>
    <!-- <div style="height:100%"> -->
    <div style="height:75vh">
        <canvas id="myChart"></canvas>
        <div id="myLoadingSymbol"></div>
    </div>

    <a id="myDownload" download="" href="" target="_blank" class="">
        <p>DOWNLOAD</p>
        <!-- Download Icon -->
        <!-- <i class="fa fa-download"></i> -->
    </a>

    <script>

        // This declaration will cause a problem when using this script in multiple places use let instead ?
        let chartID = 'myChart';
        let loadingID = 'myLoadingSymbol';
        let downloadID = 'myDownload';
        let downloadName = chartID + ".jpg";

        // document.getElementById(downloadID).addEventListener('click', DownloadChart(chartID, downloadID));
        // Move to fertsman charts
        document.getElementById(downloadID).addEventListener('click', function() {
            /*Get image of canvas element*/
            var url_base64jp = document.getElementById(chartID).toDataURL("image/jpg");
            /*get download button (tag: <a></a>) */
            var a =  document.getElementById(downloadID);
            /*insert chart image url to download button (tag: <a></a>) */
            a.href = url_base64jp;
            a.download = downloadName;
        });

        // End of Download

        var vectorBased = false;

        if (vectorBased) {
            // Optional Function Adjustments

            // Adds row ranges to FormatLinkWithVectors, call after link is formed
            // AddRowRangesToVectorLink(link, ...rows)
            // Example = (link, [1, 1], [32, 60], [80, 100000])

            // Overwrite chart headers, call after chart is created
            // Do not include "Date", it is already included. 
            // OverwriteChartHeader(chartID, ...headers)
            // Example = (chartID, "HeaderOne", "HeaderTwo")

            FormatLinkWithVectors(FinishedLink, "1hkZCymsOnrZDnZ0sItFis7NK1-PfFuZXN1Krq36TzpI", "36100434", "v65201351", "v65201528")
            //FormatLinkWithVectors(FinishedLink, "1Mb1GM7LmNWnxXr9R3zlKSPGw1XztfzBZ4Y_4JhdCb98", "StatsCan_Data", "A:H");

            function FinishedLink(link) {
                console.log("Building Chart.");
                SetupLineChart(chartID, loadingID, link, 3);
            }
        } 
        else {
            //var link = FormatLinkWithA1("1hkZCymsOnrZDnZ0sItFis7NK1-PfFuZXN1Krq36TzpI", "36100434", "A:B", "C:C")

            //var link = FormatLinkWithA1("1hkZCymsOnrZDnZ0sItFis7NK1-PfFuZXN1Krq36TzpI", "36100434", "A1:B32", "C1:C32", "A33:B1000", "C33:C1000")
           
            var link = FormatLinkWithA1("1Mb1GM7LmNWnxXr9R3zlKSPGw1XztfzBZ4Y_4JhdCb98", "Monthly_Output", "A:H")

            //var link = FormatLinkWithA1("1hkZCymsOnrZDnZ0sItFis7NK1-PfFuZXN1Krq36TzpI", "10100109_YoY", "A:A", "CJ:CJ")

            console.log(link);
            
            SetupLineChart(chartID, loadingID, link, 5,6,7);

            //OverwriteChartHeader(chartID, ...headers);
        }
    </script>
</body>

</html>