<!DOCTYPE html>
<html>
<header>
    <meta charset="utf-8">
    <title>TESTING CHART JS</title>

    <!-- Chart js bundle min -->
    <script src="https://www.chartjs.org/dist/2.9.4/Chart.min.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>

    <!-- Jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>

    <!-- Open Sans Font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
</header>

<body>
    <div style="height:50vh">
        <canvas id="myChart"></canvas>
    </div>


    <script>

        // get color 
        var lineOptions = {
            colors: ["rgba(255, 255, 255, 1)", 
                "rgba(0, 175, 181, 1)", 
                "rgba(255, 119, 0, 1)",
                "rgba(163, 0, 0, 1)", 
                "rgba(0, 71, 119, 1)", 
                "rgba(239, 210, 141, 1)"]
        }

        // Multi Right-Axis Example
        //SetupDualAxisLineChart('myChart', "LINK", 3, 3, 5);

        SetupDualAxisLineChart('myChart', "https://spreadsheets.google.com/feeds/cells/1nXewUdMlnsuKIGhVxP-Pk36aJwXFbS14jTc7mocK2FU/2/public/values?alt=json", 5, 3);

        function SetupDualAxisLineChart(chartName, link, size, ...rightAxis)
        {
            $.getJSON(link, json => 
            {
                var data = [];
                var dataNames = new Array(size);

                for (var i = 0; i < size; i++)
                {
                    data[i] = new Array();
                }

                json.feed.entry.forEach((e) => 
                {
                    const column = Number(e['gs$cell']['col']);
                    const row = Number(e['gs$cell']['row']);

                    const dataNum = Number(e['gs$cell']['col']) - 1;

                    //Data is header/name
                    if (row == 1)
                    {
                        dataNames[dataNum] = e['gs$cell']['$t'];
                        
                        //Moves to next element
                        return;
                    }

                    var value = e['gs$cell']['$t'];
                    if (column != 1)
                    {
                        Number(value);
                    }
                    data[dataNum].push(value);
                });

                Chart.defaults.global.defaultFontFamily = "Open Sans";

                var _datasets = [];
                var axisLabels = ["", ""];
                for (var i = 1; i < size; i++)
                {
                    var isRightAxis = false;

                    var axis = 'y-axis-1';
                    for (var j = 0; j < rightAxis.length; j++)
                    {
                        if (rightAxis[j] == i + 1)
                        {
                            axis = 'y-axis-2'
                            isRightAxis = true;
                            break;
                        }
                    }

                    var axisLabel = dataNames[i]
                    if (isRightAxis)
                    {
                        if (!axisLabels[1] == "")
                            axisLabels[1] = axisLabels[1] + ", ";
                        axisLabels[1] = axisLabels[1] + axisLabel;
                    }
                    else
                    {
                        if (!axisLabels[0] == "")
                            axisLabels[0] = axisLabels[0] + ", ";
                        axisLabels[0] = axisLabels[0] + axisLabel;
                    }

                    _datasets[i-1] = {
                        label: dataNames[i],
                        //For Bar Chart
                        //backgroundColor: "rgba(0, 175, 181, 1)",
                        borderColor: lineOptions.colors[i],
                        data: data[i],
                        fill: false,
                        yAxisID: axis,
                    }
                }

                console.log(axisLabels[0]);
                console.log(axisLabels[1]);

                new Chart(document.getElementById('myChart'),
                {
                    type: 'line',
                    data: {
                        labels: data[0],
                        // datasets: _datasets,
                        datasets: _datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        title: {
                            display: false,
                        },
                        tooltips: {
                            mode: 'index',
                            intersect: false,
                        },
                        hover: {
                            mode: 'nearest',
                            intersect: true
                        },
                        scales: {
                            xAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: false,
                                    //labelString: dataNames[0]
                                },
                                gridLines: {
                                    borderDash: [2, 2]
                                },
                                ticks: {
                                    // autoSkip: true,
                                    // maxTicksLimit: 10,
                                    //maxRotation: 0
                                }
                            }],
                            yAxes: [{
                                display: true,
                                position: 'left',
                                id: 'y-axis-1',
                                scaleLabel: {
                                    display: true,
                                    labelString: axisLabels[0]
                                },
                                gridLines: {
                                    borderDash: [2, 2]
                                }
                            },
                            {
                                display: true,
                                position: 'right',
                                id: 'y-axis-2',
                                scaleLabel: {
                                    display: true,
                                    labelString: axisLabels[1]
                                },
                                gridLines: {
                                    display: false,
                                    borderDash: [2, 2]
                                }
                            }]
                        },
                        elements: {
                            point:{
                                radius: 0
                            },
                        },
                        legend: {
                            display:false
                        }
                    }
                });
            });
        }
    </script>
</body>
</html>